# Spring事务

### spring事务传播行为有哪些？

> 针对事务嵌套，根据外围有无事务的情况，可以分别做出新建事务、不新建事务、挂起或者抛出异常四种不同操作，共计7种可能。

|              | 外围有事务              | 外围无事务              |
| ------------ | ----------------------- | ----------------------- |
| 创建新事务   | 外围有事务-创建新事务   | 外围无事务-创建新事务   |
| 不创建新事务 | 外围有事务-不创建新事务 | 外围无事务-不创建新事务 |
| 挂起         | 外围有事务-挂起         | -                       |
| 抛出异常     | 外围有事务-抛出异常     | 外围无事务-抛出异常     |

>  交叉组合共计 $4\times3=12$ 种

|           |   无-创建    |   无-不创建   |  无-异常  |
| :-------: | :----------: | :-----------: | :-------: |
|  有-创建  |    NESTED    |       -       |     -     |
| 有-不创建 |   REQUIRED   |   SUPPORTS    | MANDATORY |
|  有-挂起  | REQUIRES_NEW | NOT_SUPPORTED |     -     |
|  有-异常  |      -       |     NEVER     |     -     |

- REQUIRED(默认|有-不创建；无-创建)

  >  如果当前有事务，在事务中执行；如果没有，新建事务执行

- SUPPORTS(有-不创建；无-不创建)

  > 如果当前有事务，在事务中执行；如果没有，以无事务的方式执行

- MANDATORY(强制性|有-不创建；无-异常)

  > 如果当前有事务，在事务中执行；如果没有，抛出异常

- REQUIRES_NEW(有-挂起；无-创建)

  > 新建事务执行；如果当前存在事务，则挂起当前事务(如果内嵌事务执行失败，被挂起的事务也会回滚)

- NOT_SUPPORTED(有-挂起；无-不创建)

  > 以无事务的方式执行；如果当前存在事务，则挂起当前事务

- NEVER(无-不创建；有-异常)

  > 以无事务的方式执行；如果当前存在事务，抛出异常

- NESTED

  >如果当前没有事务，新建事务执行；如果当前有事务，嵌套执行
  >
  >外围事务回滚，内嵌事务一定回滚，而内嵌事务可以单独回滚而不影响外围主事务和其他子事务